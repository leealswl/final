# ëª©ì°¨(TOC) ì¶”ì¶œ ì „ì²´ íë¦„ ê°€ì´ë“œ

## ğŸ“Š ì „ì²´ íë¦„ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  detect_templates (ì–‘ì‹ ê°ì§€)           â”‚
â”‚  â€¢ ì²¨ë¶€ì„œë¥˜ì—ì„œ ì–‘ì‹ íŒŒì¼ ì°¾ê¸°           â”‚
â”‚  â€¢ ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚° (íŒŒì¼ëª…, RAG, í‘œ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  route_toc_extraction (ë¼ìš°íŒ…)          â”‚
â”‚  â€¢ find_proposal_template() í˜¸ì¶œ        â”‚
â”‚  â€¢ ì–‘ì‹ ìˆìŒ â†’ extract_toc_from_template â”‚
â”‚  â€¢ ì–‘ì‹ ì—†ìŒ â†’ extract_toc_from_...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
    ì–‘ì‹ O          ì–‘ì‹ X
        â”‚             â”‚
        â†“             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì–‘ì‹ ê¸°ë°˜    â”‚  â”‚ ê³µê³ +ì²¨ë¶€ ê¸°ë°˜         â”‚
â”‚ ëª©ì°¨ ì¶”ì¶œ    â”‚  â”‚ ëª©ì°¨ ìœ ì¶”             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ê²½ë¡œ 1: ì–‘ì‹ ê¸°ë°˜ ëª©ì°¨ ì¶”ì¶œ (extract_toc_from_template)

### ğŸ“‹ ì…ë ¥
- `state['attachment_templates']`: ì–‘ì‹ íŒŒì¼ ì •ë³´
- `state['documents']`: ì „ì²´ ë¬¸ì„œ ë¦¬ìŠ¤íŠ¸
- `state['all_chunks']`: ì²­í‚¹ëœ í…ìŠ¤íŠ¸ ì¡°ê°

### ğŸ¯ ëª©í‘œ
ì²¨ë¶€ëœ ì–‘ì‹ íŒŒì¼(ì‹ ì²­ì„œ, ê³„íšì„œ ë“±)ì—ì„œ ì‹¤ì œ ì‘ì„±í•´ì•¼ í•  ëª©ì°¨ë¥¼ ì¶”ì¶œ

---

### ğŸ“ Step 1: ì–‘ì‹ íŒŒì¼ ì°¾ê¸° ë° ê²€ì¦

```python
# 1-1. find_proposal_template()ë¡œ ìµœì  ì–‘ì‹ ì°¾ê¸°
template = find_proposal_template(templates)

# 1-2. ì–‘ì‹ì´ ì—†ìœ¼ë©´ íŒŒì¼ëª… ê¸°ë°˜ fallback ì‹œë„
if not template:
    for att_doc in attachment_docs:
        if any(kw in file_name for kw in ['ì‹ ì²­ì„œ', 'ê³„íšì„œ', 'ì œì•ˆì„œ', 'ì–‘ì‹']):
            # ì„ì‹œ í…œí”Œë¦¿ ìƒì„± (ì‹ ë¢°ë„ 0.5)
            template = {...}

# 1-3. ê·¸ë˜ë„ ì—†ìœ¼ë©´ ê¸°ë³¸ í…œí”Œë¦¿ ì‚¬ìš©
if not template:
    return create_default_toc()  # R&D ê¸°ë³¸ ëª©ì°¨ ë°˜í™˜
```

**toc_util.py ì—°ë™:**
- `find_proposal_template()`: ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ì–‘ì‹ ì„ íƒ
  - ê³„íšì„œ > ì œì•ˆì„œ > ì‹ ì²­ì„œ
  - ì²¨ë¶€ë²ˆí˜¸ 2 ìš°ì„  (+0.3 ê°€ì¤‘ì¹˜)

---

### ğŸ“ Step 2: ì–‘ì‹ ë¬¸ì„œ í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°

```python
# 2-1. Unicode ì •ê·œí™”ë¡œ íŒŒì¼ëª… ë§¤ì¹­
template_file_name = unicodedata.normalize('NFC', template['file_name'])

# 2-2. documentsì—ì„œ í•´ë‹¹ íŒŒì¼ ì°¾ê¸°
for doc in documents:
    doc_file_name = unicodedata.normalize('NFC', doc.get('file_name', ''))
    if doc_file_name == template_file_name:
        template_doc = doc  # full_text, tables í¬í•¨
        break

# 2-3. í…ìŠ¤íŠ¸ ì—†ìœ¼ë©´ ê¸°ë³¸ í…œí”Œë¦¿ ì‚¬ìš©
if not template_doc or not template_doc.get('full_text'):
    return create_default_toc()
```

---

### ğŸ“ Step 3: ì²­í‚¹ëœ í…ìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ ì¤€ë¹„

```python
# 3-1. í•´ë‹¹ ì–‘ì‹ íŒŒì¼ì˜ ì²­í¬ë§Œ í•„í„°ë§
template_chunks = [
    chunk for chunk in all_chunks
    if chunk['file_name'] == template_file_name
]

# 3-2. í˜ì´ì§€ ìˆœ ì •ë ¬ + ìƒìœ„ 20ê°œë§Œ ì„ íƒ (í† í° ì ˆì•½)
template_chunks.sort(key=lambda c: (c.get('page', 0), c.get('chunk_id', '')))
chunk_context = '\n\n'.join([
    f"[í˜ì´ì§€ {page} | {section}]\n{text[:800]}"
    for chunk in template_chunks[:20]
])

# 3-3. ì²­í¬ ì—†ìœ¼ë©´ full_text ì¼ë¶€ ì‚¬ìš© (5000ì)
if not chunk_context:
    chunk_context = full_text[:5000]
```

---

### ğŸ“ Step 4: íŒ¨í„´ ê¸°ë°˜ ìŠ¤ì¼ˆë ˆí†¤ ìƒì„± (toc_util.py í™œìš©)

```python
# 4-1. ëª©ì°¨ í‘œ ì°¾ê¸° ë° íŒŒì‹±
toc_table = find_toc_table(tables)  # PDF í‘œì—ì„œ ëª©ì°¨ í‘œ ì°¾ê¸°
table_sections = parse_toc_table(toc_table['data'])  # ë²ˆí˜¸, ì œëª© ì¶”ì¶œ

# 4-2. í…ìŠ¤íŠ¸ì—ì„œ â–¡, â– , â— íŒ¨í„´ ê¸°ë°˜ ì„¹ì…˜ ì¶”ì¶œ
clean_full_text = re.sub(r'\[í˜ì´ì§€ \d+\]', '', template_doc['full_text'])
symbol_sections = extract_sections_from_symbols(clean_full_text)
# â†’ 18ê°€ì§€ ì£¼ìš” íŒ¨í„´ + 7ê°€ì§€ í•˜ìœ„ íŒ¨í„´ ì¸ì‹
# â†’ í‰íƒ„í™”ëœ ì„¹ì…˜ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ (level: 'main'/'sub')

# 4-3. ì£¼ìš” ì„¹ì…˜ë§Œ ë¶„ë¦¬
main_sections = [sec for sec in symbol_sections if sec.get('level') == 'main']
```

**toc_util.py ì—°ë™:**
- `find_toc_table()`: í‘œì—ì„œ ëª©ì°¨ í‚¤ì›Œë“œ ë˜ëŠ” ë²ˆí˜¸ íŒ¨í„´ ê°ì§€
- `parse_toc_table()`: í–‰ë³„ë¡œ ë²ˆí˜¸/ì œëª©/í˜ì´ì§€ íŒŒì‹±
- `extract_sections_from_symbols()`: ë‹¤ì–‘í•œ ê¸°í˜¸ì™€ ë²ˆí˜¸ íŒ¨í„´ ì¸ì‹
  - ì£¼ìš” íŒ¨í„´: â–¡, â– , â—, 1., ê°€., â‘ , ã€1ã€‘ ë“± 18ê°€ì§€
  - í•˜ìœ„ íŒ¨í„´: ï¿­, â–ª, 1.1., ë“± 7ê°€ì§€

---

### ğŸ“ Step 5: ì„¹ì…˜ë³„ ë³¸ë¬¸ ë°œì·Œ (ì»¨í…ìŠ¤íŠ¸ ê°•í™”)

```python
# 5-1. ê° ì£¼ìš” ì„¹ì…˜ì˜ ì‹œì‘~ë ë¼ì¸ ë²”ìœ„ ì¶”ì¶œ
for main in main_sections:
    start_line = main['line_index']
    end_line = main['next_line_index']
    block_lines = full_lines[start_line:end_line]
    block_text = '\n'.join(block_lines).strip()

    # 5-2. ë³¸ë¬¸ ë°œì·Œ ì €ì¥ (800ì)
    main_entry['excerpt'] = block_text[:800]
    section_contexts.append({
        'number': main['number'],
        'title': main['title'],
        'excerpt': main_entry['excerpt']
    })

    # 5-3. í•˜ìœ„ ì„¹ì…˜ ì²˜ë¦¬
    subs = [s for s in symbol_sections if s['parent_number'] == main['number']]
    if subs:
        # symbol_sectionsì—ì„œ ì¶”ì¶œëœ í•˜ìœ„ ì„¹ì…˜ ì‚¬ìš©
        for sub in subs:
            sub_text = '\n'.join(full_lines[sub_start:sub_end]).strip()
            sub_entry['excerpt'] = sub_text[:600]
            section_contexts.append(...)
    else:
        # ì—†ìœ¼ë©´ extract_subsections_from_range()ë¡œ ì¬ì¶”ì¶œ
        sub_candidates = extract_subsections_from_range(
            block_lines, main['number'], start_line, end_line
        )
        # ï¿­, 1), (ê°€) íŒ¨í„´ ë§¤ì¹­
```

**í•µì‹¬ í¬ì¸íŠ¸:**
- ê° ì„¹ì…˜ì˜ ì‹¤ì œ ë³¸ë¬¸ì„ LLMì— ì œê³µ â†’ í•˜ìœ„ í•­ëª© ì¶”ì¶œ ì •í™•ë„ í–¥ìƒ
- `extract_subsections_from_range()`: 10ê°€ì§€ í•˜ìœ„ íŒ¨í„´ ë§¤ì¹­

---

### ğŸ“ Step 6: ëª©ì°¨ í…ìŠ¤íŠ¸ ì„¹ì…˜ ì¶”ì¶œ (í‚¤ì›Œë“œ ê¸°ë°˜)

```python
# 6-1. ëª©ì°¨ ì‹œì‘ í‚¤ì›Œë“œ ì°¾ê¸°
toc_start_keywords = [
    '< ë³¸ë¬¸', '<ë³¸ë¬¸', 'ë³¸ë¬¸>',
    'ì‘ì„± ëª©ì°¨', 'ì œì¶œì„œë¥˜ ëª©ì°¨', 'ê³„íšì„œ ëª©ì°¨',
    'ì‘ì„±í•­ëª©', 'ì œì¶œí•­ëª©', 'ê¸°ì¬ì‚¬í•­'
]
for keyword in toc_start_keywords:
    idx = full_text.find(keyword)
    if idx != -1:
        toc_section_start = idx
        break

# 6-2. ëª©ì°¨ ë í‚¤ì›Œë“œ ì°¾ê¸°
if toc_section_start != -1:
    end_keywords = [
        '< ë³¸ë¬¸ 2', '<ë³¸ë¬¸ 2', 'ë³¸ë¬¸ 2>',
        'ì‘ì„±ìš”ë ¹', 'ì‘ì„± ìš”ë ¹', 'ì£¼ì˜ì‚¬í•­', 'ìœ ì˜ì‚¬í•­',
        'ì°¸ê³ ì‚¬í•­', 'ê¸°ì¬ìš”ë ¹', 'ì²¨ë¶€ì„œë¥˜'
    ]
    template_text = text_after_start[:min(toc_end, 5000)]

# 6-3. í‚¤ì›Œë“œ ì—†ìœ¼ë©´ ë²ˆí˜¸ íŒ¨í„´ìœ¼ë¡œ ì°¾ê¸°
else:
    pattern = r'^[1-9]\.\s+[ê°€-í£]{2,}'
    # ì—°ì† 3ì¤„ ì´ìƒ ë²ˆí˜¸ íŒ¨í„´ì´ ë‚˜íƒ€ë‚˜ë©´ ëª©ì°¨ë¡œ íŒë‹¨
    if consecutive_numbered >= 3:
        template_text = '\n'.join(toc_lines)[:5000]

# 6-4. ê·¸ë˜ë„ ì—†ìœ¼ë©´ ì „ì²´ í…ìŠ¤íŠ¸ ì¼ë¶€ ì‚¬ìš©
if not template_text:
    template_text = full_text[:15000]
```

---

### ğŸ“ Step 7: LLM í”„ë¡¬í”„íŠ¸ êµ¬ì„± (ë‹¤ì¸µ ì»¨í…ìŠ¤íŠ¸)

```python
# 7-1. System Prompt: í¼ í•„ë“œ í•„í„°ë§ ê·œì¹™
system_prompt = """
âš ï¸ ì¤‘ìš” ê·œì¹™:
1. **í¼ ì…ë ¥ í•„ë“œëŠ” ì ˆëŒ€ ëª©ì°¨ë¡œ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”:**
   - âŒ ì œì™¸: "ê¸°ì—…ëª…", "ëŒ€í‘œì", "ì—°ë½ì²˜", "mail", "íŒ©ìŠ¤" ë“±
   - âœ… í¬í•¨: "â–¡ ê¸°ì—…í˜„í™©", "â–¡ ëª©í‘œ" ê°™ì€ ë³¸ë¬¸ ì‘ì„± ì„¹ì…˜

2. **ë³¸ë¬¸ ì‘ì„± í•­ëª©ë§Œ ëª©ì°¨ë¡œ ì¶”ì¶œ:**
   - â–¡, â– , ï¿­ë¡œ ì‹œì‘í•˜ëŠ” ì„¹ì…˜ë§Œ ì¶”ì¶œ

3. **ê³„ì¸µ êµ¬ì¡°:** 1 â†’ 1.1 â†’ 1.1.1
4. **JSON í˜•ì‹ + ìµœì†Œ 10ê°œ ì´ìƒ ì„¹ì…˜**
"""

# 7-2. User Prompt êµ¬ì„± (5ê°€ì§€ ì»¨í…ìŠ¤íŠ¸ ì œê³µ)
user_prompt = f"""
## í…œí”Œë¦¿ ì •ë³´
- íŒŒì¼ëª…: {template['file_name']}
- í˜ì´ì§€ ìˆ˜: {page_count}
- í‘œ ìˆ˜: {len(tables)}

## ì‚¬ì „ ê°ì§€ëœ ëª©ì°¨ í›„ë³´ (ì°¸ê³ ìš©)
{detected_outline}  # table_sections + symbol_sections ìš”ì•½

## ëª©ì°¨ í…ìŠ¤íŠ¸ (í‚¤ì›Œë“œ/íŒ¨í„´ ê¸°ë°˜)
{template_text}  # Step 6ì—ì„œ ì¶”ì¶œí•œ ëª©ì°¨ ì„¹ì…˜

## ì²¨ë¶€ ì–‘ì‹ ì²­í‚¹ í…ìŠ¤íŠ¸ (ìƒìœ„ 20ê°œ)
{chunk_context}  # Step 3ì—ì„œ ì¤€ë¹„í•œ ì²­í¬ ì»¨í…ìŠ¤íŠ¸

## ê°•ì œ ëª©ì°¨ ìŠ¤ì¼ˆë ˆí†¤ (number/titleì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
{skeleton_json}  # Step 4-5ì—ì„œ ìƒì„±í•œ ì„¹ì…˜ êµ¬ì¡°

## ì„¹ì…˜ë³„ ë³¸ë¬¸ ë°œì·Œ (ìƒìœ„ 20ê°œ)
{context_json}  # Step 5ì—ì„œ ì¶”ì¶œí•œ ì‹¤ì œ ë³¸ë¬¸ ë°œì·Œ
âš ï¸ ì¤‘ìš”: ê° excerptëŠ” í•´ë‹¹ â–¡ ì„¹ì…˜ì˜ ì‹¤ì œ ì›ë¬¸ì…ë‹ˆë‹¤.
ì´ í…ìŠ¤íŠ¸ë¥¼ ì½ì–´ì„œ í•˜ìœ„ í•­ëª©(ï¿­, 1), (ê°€))ì„ íŒŒì•…í•˜ì„¸ìš”.
"""
```

**LLMì—ê²Œ ì œê³µí•˜ëŠ” ì •ë³´:**
1. í…œí”Œë¦¿ ê¸°ë³¸ ì •ë³´
2. íŒ¨í„´ ê¸°ë°˜ìœ¼ë¡œ ê°ì§€ëœ ì„¹ì…˜ ê°œìš”
3. í‚¤ì›Œë“œ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì¶œí•œ ëª©ì°¨ í…ìŠ¤íŠ¸
4. ì²­í‚¹ëœ ìƒìœ„ 20ê°œ ì¡°ê°
5. **ìŠ¤ì¼ˆë ˆí†¤ (number/title ê°•ì œ)** â† í•µì‹¬!
6. **ì„¹ì…˜ë³„ ë³¸ë¬¸ ë°œì·Œ (ì‹¤ì œ ì›ë¬¸)** â† í•µì‹¬!

---

### ğŸ“ Step 8: LLM í˜¸ì¶œ ë° ê²°ê³¼ ì²˜ë¦¬

```python
# 8-1. OpenAI API í˜¸ì¶œ (JSON mode)
response = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_prompt}
    ],
    response_format={"type": "json_object"},
    temperature=0
)

# 8-2. ê²°ê³¼ íŒŒì‹±
result = json.loads(response.choices[0].message.content)
sections = result.get('sections', [])

# 8-3. base_sections ìˆìœ¼ë©´ ë³‘í•© (ìŠ¤ì¼ˆë ˆí†¤ ìš°ì„ )
if base_sections:
    llm_map = {sec.get('number'): sec for sec in sections}
    final_sections = []
    for base in base_sections:
        llm_candidate = llm_map.get(base['number'], {})
        merged = {
            'number': base['number'],  # ìŠ¤ì¼ˆë ˆí†¤ ë²ˆí˜¸ ìœ ì§€
            'title': base['title'],    # ìŠ¤ì¼ˆë ˆí†¤ ì œëª© ìœ ì§€
            'required': llm_candidate.get('required', True),
            'description': llm_candidate.get('description') or base.get('excerpt', '')
        }
        final_sections.append(merged)

# 8-4. base_sections ì—†ìœ¼ë©´ í¼ í•„ë“œ í•„í„°ë§
else:
    form_field_keywords = ['mail', 'e-mail', 'íŒ©ìŠ¤', 'ì „í™”', ...]
    final_sections = []
    for sec in sections:
        # í¼ í•„ë“œ í‚¤ì›Œë“œ ì œì™¸
        if any(keyword in title_lower for keyword in form_field_keywords):
            continue
        # ë§ˆì»¤(â–¡, â– , â—) ì—†ìœ¼ë©´ ì œì™¸
        has_marker = any(marker in original_title for marker in ['â–¡', 'â– ', 'â—', 'â—‹'])
        if not has_marker:
            continue
        final_sections.append(sec)
```

**ë³‘í•© ì „ëµ:**
- **base_sections ìˆìŒ (ì •ìƒ ì¼€ì´ìŠ¤):**
  - ìŠ¤ì¼ˆë ˆí†¤ì˜ number/title ê·¸ëŒ€ë¡œ ì‚¬ìš©
  - LLMì˜ description/requiredë§Œ ë³‘í•©
  - ìˆœì„œ ë³´ì¥

- **base_sections ì—†ìŒ (ì˜ˆì™¸ ì¼€ì´ìŠ¤):**
  - LLMì´ ì „ì²´ í…ìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œ
  - í¼ í•„ë“œ í‚¤ì›Œë“œ í•„í„°ë§ ì ìš©
  - ë§ˆì»¤(â–¡, â– , â—) ìˆëŠ” ê²ƒë§Œ í¬í•¨

---

### ğŸ“ Step 9: ìµœì¢… ëª©ì°¨ êµ¬ì¡° ìƒì„±

```python
toc = {
    'source': 'template',
    'source_file': template['file_name'],
    'extraction_method': 'llm_template_chunks',
    'sections': final_sections,
    'total_sections': len(final_sections),
    'has_page_numbers': False,
    'extracted_at': datetime.now().isoformat()
}

state['table_of_contents'] = toc
state['status'] = 'toc_extracted'
```

---

## ğŸ”„ ê²½ë¡œ 2: ê³µê³ +ì²¨ë¶€ ê¸°ë°˜ ëª©ì°¨ ìœ ì¶” (extract_toc_from_announcement_and_attachments)

### ğŸ“‹ ì…ë ¥
- `state['extracted_features']`: RAGë¡œ ì¶”ì¶œí•œ Feature (ì œì¶œì„œë¥˜ ë“±)
- `state['chroma_collection']`: ë²¡í„° DB
- `state['documents']`: ì „ì²´ ë¬¸ì„œ

### ğŸ¯ ëª©í‘œ
ì–‘ì‹ íŒŒì¼ì´ ì—†ì„ ë•Œ, ê³µê³ ë¬¸ê³¼ ì²¨ë¶€ì„œë¥˜ë¥¼ ë¶„ì„í•˜ì—¬ ì œì¶œí•´ì•¼ í•  ê³„íšì„œì˜ ëª©ì°¨ë¥¼ ìœ ì¶”

---

### ğŸ“ Step 1: ì œì¶œì„œë¥˜ Feature ì°¾ê¸°

```python
# 1-1. extract_features_rag()ì—ì„œ ì¶”ì¶œí•œ ì œì¶œì„œë¥˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
submission_features = [
    f for f in all_features
    if f.get('feature_code') == 'submission_docs'
]

# 1-2. ì—†ìœ¼ë©´ ê¸°ë³¸ í…œí”Œë¦¿ ì‚¬ìš©
if not submission_features:
    return create_default_toc()

# 1-3. ì œì¶œì„œë¥˜ ë‚´ìš© ê²°í•©
submission_content = '\n\n'.join([
    f.get('full_content', '') for f in submission_features
])
```

**ì—°ë™:**
- `processing.py::extract_features_rag()` â†’ `submission_docs` Feature ìƒì„±
- ê³µê³ ë¬¸ì—ì„œ "ì œì¶œì„œë¥˜" ì„¹ì…˜ì„ RAGë¡œ ì¶”ì¶œí•œ ê²°ê³¼

---

### ğŸ“ Step 2: RAG ê²€ìƒ‰ (ê³µê³  + ëª¨ë“  ì²¨ë¶€ì„œë¥˜)

```python
# 2-1. ì¿¼ë¦¬ ì„ë² ë”© ìƒì„±
query_text = "ì œì¶œì„œë¥˜ ì‘ì„±í•­ëª© êµ¬ì„± ëª©ì°¨ ì œì•ˆì„œ ê³„íšì„œ ì‚¬ì—…ê³„íšì„œ ìš´ì˜ê³„íš"
query_response = client.embeddings.create(
    model="text-embedding-3-small",
    input=[query_text]
)
query_embedding = [query_response.data[0].embedding]

# 2-2. VectorDB ìœ ì‚¬ë„ ê²€ìƒ‰ (25ê°œ ì²­í¬)
results = collection.query(
    query_embeddings=query_embedding,
    n_results=25  # ë” ë§ì€ ì»¨í…ìŠ¤íŠ¸ í™•ë³´
    # where ì¡°ê±´ ì—†ìŒ â†’ ê³µê³ ë¬¸ + ëª¨ë“  ì²¨ë¶€ì„œë¥˜ ê²€ìƒ‰
)

# 2-3. ê²€ìƒ‰ ê²°ê³¼ ì •ë¦¬
all_chunks = []
for i in range(len(ids)):
    all_chunks.append({
        'text': documents[i],
        'file': metadata['file_name'],
        'section': metadata['section'],
        'doc_type': metadata['document_type']  # ANNOUNCEMENT or ATTACHMENT
    })
```

---

### ğŸ“ Step 3: LLM í”„ë¡¬í”„íŠ¸ êµ¬ì„± (í‘œì¤€ ëª©ì°¨ êµ¬ì¡° ì œê³µ)

```python
# 3-1. System Prompt: ê³µê³  ìœ í˜•ë³„ í‘œì¤€ ëª©ì°¨ êµ¬ì¡° ì œê³µ
system_prompt = """
âš ï¸ ê³µê³ ì˜ ì„±ê²©ì„ ë¨¼ì € íŒŒì•…í•˜ì„¸ìš”:
- ì—°êµ¬ê°œë°œ(R&D) ê³¼ì œ ê³µê³  â†’ ì—°êµ¬ê³„íšì„œ ëª©ì°¨
- ì°½ì—…ì§€ì› ì‚¬ì—… ê³µê³  â†’ ì‚¬ì—…ê³„íšì„œ ëª©ì°¨
- ì£¼ê´€ê¸°ê´€ ì„ ì • ê³µê³  â†’ ì£¼ê´€ê¸°ê´€ ì‚¬ì—…ê³„íšì„œ ëª©ì°¨

ğŸ“š ê³µê³  ìœ í˜•ë³„ í‘œì¤€ ëª©ì°¨ êµ¬ì¡° ì°¸ê³ :

ã€ì—°êµ¬ê°œë°œ(R&D) ê³¼ì œã€‘
1. ì—°êµ¬ê°œë°œê³¼ì œì˜ ê°œìš” (í•„ìˆ˜)
   1.1. ê³¼ì œì˜ í•„ìš”ì„±
   1.2. ê³¼ì œì˜ ëª©í‘œ
2. ì—°êµ¬ê°œë°œ ëª©í‘œ ë° ë‚´ìš© (í•„ìˆ˜)
   2.1. ì—°êµ¬ê°œë°œ ëª©í‘œ
   2.2. ì—°êµ¬ê°œë°œ ë‚´ìš©
   ...

ã€ì°½ì—…ì§€ì›/ì‚¬ì—…ê³„íšì„œã€‘
1. ì‚¬ì—… ê°œìš” (í•„ìˆ˜)
   1.1. ì‚¬ì—… ë°°ê²½ ë° í•„ìš”ì„±
   ...

ğŸ“‹ ëª©ì°¨ ìƒì„± ìš”êµ¬ì‚¬í•­:
1. **ìµœì†Œ 10-15ê°œ ì´ìƒì˜ ì„¹ì…˜ ìƒì„±**
2. **ê³„ì¸µ êµ¬ì¡° í•„ìˆ˜ í¬í•¨** (1, 1.1, 1.2...)
3. í‘œì¤€ êµ¬ì¡°ë¥¼ ì°¸ê³ í•˜ë˜, ì‹¤ì œ ê³µê³  ë‚´ìš© ë°˜ì˜
"""

# 3-2. User Prompt êµ¬ì„± (3ê°€ì§€ ì»¨í…ìŠ¤íŠ¸)
document_context = '\n\n'.join([
    f"[{c['doc_type']} - {c['file']} - {c['section']}]\n{c['text']}"
    for c in all_chunks[:20]  # ìƒìœ„ 20ê°œ
])

user_prompt = f"""
## ê³µê³ ë¬¸ ë‚´ìš©
{announcement_text[:5000]}  # ê³µê³ ë¬¸ ì „ì²´ ë‚´ìš© ì¼ë¶€

## ì œì¶œì„œë¥˜ ìš”êµ¬ì‚¬í•­
{submission_content[:3000]}  # Step 1ì—ì„œ ì¶”ì¶œí•œ ì œì¶œì„œë¥˜ ì •ë³´

## ì²¨ë¶€ì„œë¥˜ ê´€ë ¨ ë‚´ìš© (ì–‘ì‹/ê³„íšì„œì˜ ì‘ì„± í•­ëª©)
{document_context[:4000]}  # Step 2 RAG ê²€ìƒ‰ ê²°ê³¼

---

## ğŸ“‹ ë¶„ì„ ë° ëª©ì°¨ ìƒì„± ì§€ì¹¨

### 1ë‹¨ê³„: ê³µê³  ì„±ê²© íŒŒì•…
- [ ] ì—°êµ¬ê°œë°œ(R&D) ê³¼ì œ ê³µê³ 
- [ ] ì°½ì—…ì§€ì›/ë²¤ì²˜ ì§€ì› ì‚¬ì—… ê³µê³ 
- [ ] ì£¼ê´€ê¸°ê´€/ìš´ì˜ê¸°ê´€ ì„ ì • ê³µê³ 

### 2ë‹¨ê³„: ëª©ì°¨ êµ¬ì¡° ìƒì„±
í‘œì¤€ ëª©ì°¨ êµ¬ì¡°ë¥¼ ì°¸ê³ í•˜ë˜, **ê³µê³ ë¬¸ê³¼ ì²¨ë¶€ì„œë¥˜ì—ì„œ ì‹¤ì œë¡œ ì–¸ê¸‰ëœ ì‘ì„± í•­ëª©**ì„ ë°˜ë“œì‹œ ë°˜ì˜í•˜ì„¸ìš”.

**âš ï¸ ë°˜ë“œì‹œ ì¤€ìˆ˜:**
1. ìµœì†Œ 10-15ê°œ ì´ìƒì˜ ì„¹ì…˜ ìƒì„±
2. ê³„ì¸µ êµ¬ì¡° í•„ìˆ˜ (1, 1.1, 1.2...)
3. "ì„œë¥˜ëª…"ì´ ì•„ë‹Œ "ì‘ì„± í•­ëª©"ë§Œ ì¶”ì¶œ
"""
```

**LLMì—ê²Œ ì œê³µí•˜ëŠ” ì •ë³´:**
1. ê³µê³ ë¬¸ ì „ì²´ ë‚´ìš© (5000ì)
2. ì œì¶œì„œë¥˜ ìš”êµ¬ì‚¬í•­ (3000ì)
3. RAG ê²€ìƒ‰ ê²°ê³¼ (20ê°œ ì²­í¬, 4000ì)
4. **í‘œì¤€ ëª©ì°¨ êµ¬ì¡°** (R&D, ì°½ì—…ì§€ì›, ì£¼ê´€ê¸°ê´€) â† í•µì‹¬!
5. **3ë‹¨ê³„ ë¶„ì„ í”„ë¡œì„¸ìŠ¤** â† í•µì‹¬!

---

### ğŸ“ Step 4: LLM í˜¸ì¶œ ë° ê²°ê³¼ ì²˜ë¦¬

```python
# 4-1. OpenAI API í˜¸ì¶œ (JSON mode)
response = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_prompt}
    ],
    response_format={"type": "json_object"},
    temperature=0
)

# 4-2. ê²°ê³¼ íŒŒì‹±
result = json.loads(response.choices[0].message.content)

# 4-3. ìµœì¢… ëª©ì°¨ êµ¬ì¡° ìƒì„±
toc = {
    'source': 'announcement',
    'extraction_method': 'rag_llm',
    'inference_confidence': 0.7,  # RAG + LLM ê¸°ë°˜ì´ë¯€ë¡œ ì¤‘ê°„ ì‹ ë¢°ë„
    'sections': result['sections'],
    'total_sections': len(result['sections']),
    'extracted_at': datetime.now().isoformat()
}
```

---

## ğŸ”§ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (toc_util.py)

### 1. `find_proposal_template(templates)`
**ëª©ì :** ì—¬ëŸ¬ ì²¨ë¶€ íŒŒì¼ ì¤‘ ëª©ì°¨ê°€ ìˆëŠ” ì–‘ì‹ íŒŒì¼ ì°¾ê¸°

**ìš°ì„ ìˆœìœ„ ê·œì¹™:**
1. 'ê³„íšì„œ' í¬í•¨ íŒŒì¼ â†’ ìµœìš°ì„  ë°˜í™˜
2. ê·¸ ì™¸ëŠ” ì ìˆ˜ ê³„ì‚°:
   - íŒŒì¼ëª… í‚¤ì›Œë“œ: ê³„íšì„œ(+1.0), ì œì•ˆì„œ(+0.8), ì‹ ì²­ì„œ(+0.6)
   - ì²¨ë¶€ë²ˆí˜¸ 2: +0.3
   - confidence_score ëˆ„ì 

**ë°˜í™˜:** ìµœê³  ì ìˆ˜ í…œí”Œë¦¿ or None

---

### 2. `find_toc_table(tables)`
**ëª©ì :** PDF í‘œ ì¤‘ ëª©ì°¨ í‘œ ì°¾ê¸°

**ì‹ë³„ ë°©ë²•:**
1. **í‚¤ì›Œë“œ ê¸°ë°˜:** ì²« í–‰ì— 'ëª©ì°¨', 'ì‘ì„±í•­ëª©', 'êµ¬ì„±' ë“± í¬í•¨
2. **íŒ¨í„´ ê¸°ë°˜:** ë²ˆí˜¸ íŒ¨í„´(1., ê°€., â‘ )ì´ í–‰ì˜ 30% ì´ìƒ

**ë°˜í™˜:** ëª©ì°¨ í‘œ or None

---

### 3. `parse_toc_table(table_data)`
**ëª©ì :** ëª©ì°¨ í‘œ íŒŒì‹±

**ê³¼ì •:**
1. í—¤ë” í–‰ ìŠ¤í‚µ (ì²« ë²ˆì§¸ í–‰)
2. ê° í–‰ì—ì„œ ì„¹ì…˜ ë²ˆí˜¸ ì¶”ì¶œ (ì •ê·œì‹ íŒ¨í„´ ë§¤ì¹­)
3. ì œëª©ê³¼ í˜ì´ì§€ ë²ˆí˜¸ ë¶„ë¦¬
4. í•„í„°ë§ (ë„ˆë¬´ ì§§ê±°ë‚˜ 'í•©ê³„', 'ê³„', 'ë¹„ê³ ' ì œì™¸)

**ë°˜í™˜:** `[{number, title, page, row_index}, ...]`

---

### 4. `extract_sections_from_symbols(full_text)`
**ëª©ì :** PDF í…ìŠ¤íŠ¸ì—ì„œ íŒ¨í„´ ê¸°ë°˜ ì„¹ì…˜ ì¶”ì¶œ

**ì§€ì› íŒ¨í„´:**
- **ì£¼ìš” ì„¹ì…˜ (18ê°€ì§€):** â–¡, â– , â—, 1., ê°€., â‘ , ã€1ã€‘, [1], I., â… ., - ë“±
- **í•˜ìœ„ ì„¹ì…˜ (7ê°€ì§€):** ï¿­, â–ª, â–«, 1.1., 1.1), (1.1) ë“±

**ê³¼ì •:**
1. "ì‚¬ì—… ìˆ˜í–‰ ê³„íšì„œ" í‚¤ì›Œë“œ ì°¾ê¸° (10ê°€ì§€ ë³€í˜•)
2. ë‹¤ìŒ 10ì¤„ ì•ˆì— â–¡ íŒ¨í„´ ìˆìœ¼ë©´ ëª©ì°¨ ì„¹ì…˜ ì‹œì‘
3. ì£¼ìš”/í•˜ìœ„ ì„¹ì…˜ íŒ¨í„´ ë§¤ì¹­
4. "ê°œì¸ì •ë³´ ë™ì˜ì„œ" ì„¹ì…˜ì—ì„œ ì¤‘ë‹¨
5. í•„í„°ë§: ê°œì¸ì •ë³´, ì‹ ìš©ë³´ì¦ ê´€ë ¨ ì œì™¸

**ë°˜í™˜:** í‰íƒ„í™”ëœ ì„¹ì…˜ ë¦¬ìŠ¤íŠ¸ (level: 'main'/'sub')

---

### 5. `extract_subsections_from_range(lines_block, parent_number, ...)`
**ëª©ì :** íŠ¹ì • ë¼ì¸ ë²”ìœ„ì—ì„œ í•˜ìœ„ ì„¹ì…˜ ì¶”ì¶œ

**íŒ¨í„´ (10ê°€ì§€):**
- ï¿­, â–ª, â–«, -, â—, â—‹
- 1), (1), ê°€), (ê°€)

**ë°˜í™˜:** `[{number, title, level: 'sub', parent_number, line_index}, ...]`

---

### 6. `create_default_toc()`
**ëª©ì :** ëª¨ë“  ì¶”ì¶œ ë°©ë²• ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ëª©ì°¨ ì œê³µ

**ë°˜í™˜:**
```python
{
    'source': 'default',
    'extraction_method': 'fallback',
    'inference_confidence': 0.3,
    'sections': [
        {'number': '1', 'title': 'ì—°êµ¬ê°œë°œ ê³¼ì œì˜ ê°œìš”', ...},
        {'number': '2', 'title': 'ì—°êµ¬ê°œë°œ ëª©í‘œ ë° ë‚´ìš©', ...},
        {'number': '3', 'title': 'ì—°êµ¬ê°œë°œ ì¶”ì§„ì²´ê³„ ë° ì¼ì •', ...},
        {'number': '4', 'title': 'ì—°êµ¬ê°œë°œ ì„±ê³¼ í™œìš©ë°©ì•ˆ', ...},
        {'number': '5', 'title': 'ì†Œìš”ì˜ˆì‚°', ...},
    ],
    'total_sections': 5,
}
```

---

## ğŸ“Š ì£¼ìš” ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1-3: ì»¨í…ìŠ¤íŠ¸ ì¤€ë¹„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ì–‘ì‹ íŒŒì¼ í…ìŠ¤íŠ¸ (full_text)                  â”‚
â”‚ â€¢ ì²­í‚¹ëœ ì¡°ê° (template_chunks, 20ê°œ)           â”‚
â”‚ â€¢ ì²­í¬ ì»¨í…ìŠ¤íŠ¸ (chunk_context)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: íŒ¨í„´ ê¸°ë°˜ ìŠ¤ì¼ˆë ˆí†¤ ìƒì„±                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [toc_util.py]                                    â”‚
â”‚ â€¢ find_toc_table() â†’ ëª©ì°¨ í‘œ ì°¾ê¸°               â”‚
â”‚ â€¢ parse_toc_table() â†’ ë²ˆí˜¸/ì œëª© ì¶”ì¶œ            â”‚
â”‚ â€¢ extract_sections_from_symbols() â†’ íŒ¨í„´ ì¶”ì¶œ   â”‚
â”‚                                                  â”‚
â”‚ [toc_extraction.py]                              â”‚
â”‚ â€¢ main_sections ë¶„ë¦¬                            â”‚
â”‚ â€¢ base_sections ìƒì„± (number, title, level)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: ì„¹ì…˜ë³„ ë³¸ë¬¸ ë°œì·Œ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ê° ì£¼ìš” ì„¹ì…˜ì˜ ë¼ì¸ ë²”ìœ„ ê³„ì‚°                 â”‚
â”‚ â€¢ block_text ì¶”ì¶œ (800ì)                       â”‚
â”‚ â€¢ section_contexts ìƒì„± (number, title, excerpt)â”‚
â”‚                                                  â”‚
â”‚ â€¢ í•˜ìœ„ ì„¹ì…˜ ì²˜ë¦¬:                               â”‚
â”‚   - symbol_sectionsì—ì„œ ì°¾ê¸°                   â”‚
â”‚   - ì—†ìœ¼ë©´ extract_subsections_from_range()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: ëª©ì°¨ í…ìŠ¤íŠ¸ ì„¹ì…˜ ì¶”ì¶œ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ í‚¤ì›Œë“œ ê¸°ë°˜ ë²”ìœ„ ì°¾ê¸° ('< ë³¸ë¬¸', 'ì‘ì„± ëª©ì°¨')â”‚
â”‚ â€¢ ë²ˆí˜¸ íŒ¨í„´ ê¸°ë°˜ ë²”ìœ„ ì°¾ê¸° (1., 2., 3. ...)    â”‚
â”‚ â€¢ template_text ìƒì„± (5000ì)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7-8: LLM í”„ë¡¬í”„íŠ¸ êµ¬ì„± ë° í˜¸ì¶œ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [User Prompt - 5ê°€ì§€ ì»¨í…ìŠ¤íŠ¸]                  â”‚
â”‚ 1. í…œí”Œë¦¿ ì •ë³´ (íŒŒì¼ëª…, í˜ì´ì§€, í‘œ)            â”‚
â”‚ 2. ì‚¬ì „ ê°ì§€ëœ ëª©ì°¨ í›„ë³´                        â”‚
â”‚ 3. ëª©ì°¨ í…ìŠ¤íŠ¸ (í‚¤ì›Œë“œ/íŒ¨í„´)                    â”‚
â”‚ 4. ì²­í‚¹ í…ìŠ¤íŠ¸ (20ê°œ)                           â”‚
â”‚ 5. ìŠ¤ì¼ˆë ˆí†¤ (base_sections JSON)               â”‚
â”‚ 6. ì„¹ì…˜ë³„ ë³¸ë¬¸ ë°œì·Œ (section_contexts JSON)    â”‚
â”‚                                                  â”‚
â”‚ [LLM ì—­í• ]                                       â”‚
â”‚ â€¢ ìŠ¤ì¼ˆë ˆí†¤ number/title ê·¸ëŒ€ë¡œ ì‚¬ìš©             â”‚
â”‚ â€¢ excerpt ì½ê³  í•˜ìœ„ í•­ëª©(ï¿­, 1), (ê°€)) ì¶”ì¶œ     â”‚
â”‚ â€¢ description, required ìƒì„±                    â”‚
â”‚ â€¢ í¼ í•„ë“œ í•„í„°ë§ (mail, íŒ©ìŠ¤, ì—°ë½ì²˜ ë“±)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 9: ìµœì¢… ëª©ì°¨ êµ¬ì¡° ìƒì„±                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ base_sections ìˆìœ¼ë©´: ìŠ¤ì¼ˆë ˆí†¤ ë³‘í•©          â”‚
â”‚ â€¢ base_sections ì—†ìœ¼ë©´: í¼ í•„ë“œ í•„í„°ë§          â”‚
â”‚                                                  â”‚
â”‚ toc = {                                          â”‚
â”‚   'source': 'template',                          â”‚
â”‚   'source_file': '...',                          â”‚
â”‚   'extraction_method': 'llm_template_chunks',    â”‚
â”‚   'sections': final_sections,                    â”‚
â”‚   'total_sections': len(final_sections)          â”‚
â”‚ }                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸ ì •ë¦¬

### âœ… ì–‘ì‹ ê¸°ë°˜ ì¶”ì¶œì˜ ê°•ì 
1. **ë‹¤ì¸µ ì»¨í…ìŠ¤íŠ¸:** 5ê°€ì§€ ì •ë³´ì› ê²°í•© (í‘œ, íŒ¨í„´, í…ìŠ¤íŠ¸, ì²­í¬, ë³¸ë¬¸)
2. **ìŠ¤ì¼ˆë ˆí†¤ ê°•ì œ:** íŒ¨í„´ ê¸°ë°˜ ì„¹ì…˜ êµ¬ì¡°ë¥¼ LLMì— ê°•ì œë¡œ ì œê³µ
3. **ì‹¤ì œ ë³¸ë¬¸ ë°œì·Œ:** ê° ì„¹ì…˜ì˜ ì›ë¬¸ì„ LLMì´ ì½ê³  í•˜ìœ„ í•­ëª© ì¶”ì¶œ
4. **í¼ í•„ë“œ í•„í„°ë§:** "ê¸°ì—…ëª…", "ì—°ë½ì²˜" ë“± ì œì™¸

### âœ… ê³µê³  ê¸°ë°˜ ìœ ì¶”ì˜ ê°•ì 
1. **RAG ê²€ìƒ‰:** ê³µê³ +ì²¨ë¶€ 25ê°œ ì²­í¬ì—ì„œ ê´€ë ¨ ì •ë³´ ê²€ìƒ‰
2. **í‘œì¤€ ëª©ì°¨ ì œê³µ:** R&D, ì°½ì—…ì§€ì›, ì£¼ê´€ê¸°ê´€ë³„ í…œí”Œë¦¿ ì œê³µ
3. **3ë‹¨ê³„ ë¶„ì„:** ê³µê³  ì„±ê²© íŒŒì•… â†’ í‘œì¤€ êµ¬ì¡° ì°¸ê³  â†’ ì‹¤ì œ ë‚´ìš© ë°˜ì˜
4. **ìœ ì—°í•œ ì¶”ë¡ :** LLMì´ ê³µê³  ë‚´ìš© ê¸°ë°˜ìœ¼ë¡œ ëª©ì°¨ ìƒì„±

### âš ï¸ Fallback ì „ëµ
- ëª¨ë“  ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨ ì‹œ â†’ `create_default_toc()` í˜¸ì¶œ
- R&D ê¸°ë³¸ ëª©ì°¨ 5ê°œ ì„¹ì…˜ ì œê³µ
- ì‹ ë¢°ë„ 0.3ìœ¼ë¡œ í‘œì‹œ

---

**ì‘ì„±ì¼:** 2025-11-19
**ì‘ì„±ì:** AI Assistant
**ëª©ì :** toc_extraction.py + toc_util.py ì „ì²´ íë¦„ ì´í•´
