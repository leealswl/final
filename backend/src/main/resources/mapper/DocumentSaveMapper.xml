<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.backend.mapper.DocumentSaveMapper">

    <!-- 1) 새 문서 INSERT -->
    <insert id="insertDocument" parameterType="com.example.backend.domain.DocumentSave">
        <!-- Oracle: 시퀀스로 PK 생성 -->
        <selectKey keyProperty="documentIdx" resultType="long" order="BEFORE">
            SELECT document_seq.NEXTVAL FROM dual
        </selectKey>

        INSERT INTO documents (
            document_idx,
            project_idx,
            folder,
            file_name,
            file_path,
            content,
            created_at,
            updated_at
        ) VALUES (
            #{documentIdx},
            #{projectIdx},
            2,                          
            #{fileName},
            '/some/path',               
            #{content},
            SYSDATE,
            SYSDATE
        )
    </insert>

    <!-- 2) 기존 문서 UPDATE (content + updated_at만) -->
    <update id="updateDocumentContent" parameterType="com.example.backend.domain.DocumentSave">
        UPDATE documents
        SET
            content    = #{content},
            updated_at = SYSDATE
        WHERE document_idx = #{documentIdx}
          AND project_idx  = #{projectIdx}
    </update>

</mapper>